<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Nonunonu</title>
	
	
	<style type="text/css">
.swatch_color {
  display: inline;   
  width: 12px;
  height: 12px;
}
	</style>

	<script type="text/javascript" src="js/mootools-core-1.3.2-full-compat.js"></script>
  <script type="text/javascript">
  
  function drawSwatch(num, hex) {
    console.log("Num: " +num);
    var el = $('swatch_color_' + num);
    console.log(el);
    var context = el.getContext("2d");	
		context.clearRect(0, 0, el.width, el.height);
		context.fillStyle = "#" + hex;
		context.fillRect(0, 0, 12, 12);		    
  }

  function valueChanged(target) {
    return target.prevValue != target.value;
  }

  function isValidHex(value) {
    var regex = /^[0-9a-fA-F]{3}(|[0-9a-fA-F]{3})$/;
    return value.match(regex) ? true : false;
  }

  function hexChanged(e) {
    if (valueChanged(e.target) && isValidHex(e.target.value)) {
      console.log(e.target.value);      
       var swatchNum = String(e.target.id).substring("swatch_hex_".length);
       drawSwatch(swatchNum, e.target.value);
    }
    e.target.prevValue = e.target.value;
  }


  function createSwatch(n) {
    var canvasDiv = new Element('div', {
      'class': 'swatch_color'
    });
    var canvas = new Element('canvas',{
      id: 'swatch_color_' + n,
      'class': 'swatch_color',
      width: 12,
      height: 12
    });
    canvasDiv.adopt(canvas);
    
    var hexValue = new Element('input', {
      id: 'swatch_hex_' + n,
      type: 'text',
      maxlength: 6,
      events: {
        'keyup': hexChanged        
      }
    })

    var swatch = new Element('div', {
      id: 'swatch_' + n,      
    });
    swatch.adopt(canvasDiv);
    swatch.adopt(hexValue);
    
    return swatch;
  }

  window.addEvent('load', function() {
    
    var nColors = 3;
    var palatte = $('color_palatte');
    for (var n = 0; n < nColors; n++) {
      var swatch = createSwatch(n);
      palatte.adopt(swatch);
      console.log($('swatch_color_' + n));
    }
    
  });
  </script>

</head>
<body>

<form>
<p>Palette</p>
<div id="color_palatte">
  <!--
  <div>
    <div class="color_swatch">
      <canvas class="color_swatch" id="color_swatch_0" width="12" height="12" />
    </div>
    <input type="text" id="color_hex_0" maxlength="6" />
  </div>
  -->
</div>
</form>

</body>
</html>		
